<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQEAYAAABPYyMiAAAABmJLR0T///////8JWPfcAAAACXBIWXMAAABIAAAASABGyWs+AAAAF0lEQVRIx2NgGAWjYBSMglEwCkbBSAcACBAAAeaR9cIAAAAASUVORK5CYII=" rel="icon" type="image/x-icon" />
<title>List</title>
<style>
	body{
		margin:1em auto;
		max-width:40em;
		padding:0 .62em;
		font:1.2em/1.62 serif;
	}
	h1,h2,h3 {
		line-height:1.2;
	}
</style>
<article>
	<header>
		<a href="/"><img width=140 heihgt=140 src="../bird.png"></a>
		
	</header>

	<h1>List</h1>	

	<div id="myDIV" class="header">
	  <input type="text" id="myInput" placeholder="Title...">
	  <span onclick="newElement()" class="addBtn">Add</span>
	</div>
	
	<ul id="myUL">
	
	</ul>


	<input type="text" id="code" value="" />
	<button data-copytarget="#code" class="addBtn">copy</button>

	<style>

		* {
		    box-sizing: border-box;
		}
		ul {
		    margin: 0;
		    padding: 0;
		}
		ul li {
		    cursor: pointer;
		    position: relative;
		    padding: 12px 8px 12px 40px;
		    background: #eee;
		    font-size: 18px;
		    transition: 0.2s;
		    list-style-type: none;

		    /* make the list items unselectable */
		    -webkit-user-select: none;
		    -moz-user-select: none;
		    -ms-user-select: none;
		    user-select: none;
		}

		ul li:nth-child(odd) {
		    background: #f9f9f9;
		}

		/* Darker background-color on hover */
		ul li:hover {
		    background: #ddd;
		}

		/* When clicked on, add a background color and strike out text */
		ul li.checked {
		    background: #888;
		    color: #fff;
		    text-decoration: line-through;
		}

		/* Add a "checked" mark when clicked on */
		ul li.checked::before {
		    content: '';
		    position: absolute;
		    border-color: #fff;
		    border-style: solid;
		    border-width: 0 2px 2px 0;
		    top: 10px;
		    left: 16px;
		    transform: rotate(45deg);
		    height: 15px;
		    width: 7px;
		}

		/* Style the close button */
		.close {
		    position: absolute;
		    right: 0;
		    top: 0;
		    padding: 12px 16px 12px 16px;
		}

		.close:hover {
		    background-color: #f44336;
		    color: white;
		}

		/* Style the header */
		.header {
		    padding: 10px 40px;
		}

		/* Clear floats after the header */
		.header:after {
		    content: "";
		    display: table;
		    clear: both;
		}

		/* Style the input */
		input {
		    border: 3px solid black;
		    width: 75%;
		    padding: 10px;
		    float: left;
		    font-size: 16px;
		}

		/* Style the "Add" button */
		.addBtn {
		    padding: 10px;
		    width: 25%;
		    background: #000;
		    color: #fff;
		    float: left;
		    text-align: center;
		    font-size: 16px;
		    cursor: pointer;
		    transition: 0.3s;
		}

		.addBtn:hover {
		    background-color: #bbb;
}
	</style>

	<script>
	// Create a "close" button and append it to each list item
	var myNodelist = document.getElementsByTagName("LI");
	var i;
	for (i = 0; i < myNodelist.length; i++) {
	  var span = document.createElement("SPAN");
	  var txt = document.createTextNode("\u00D7");
	  span.className = "close";
	  span.appendChild(txt);
	  myNodelist[i].appendChild(span);
	}

	// Click on a close button to hide the current list item
	var close = document.getElementsByClassName("close");
	var i;
	for (i = 0; i < close.length; i++) {
	  close[i].onclick = function() {
	    var div = this.parentElement;
	    //div.style.display = "none";
	    console.log(div)
	  }
	}

	// Add a "checked" symbol when clicking on a list item
	var list = document.querySelector('ul');
	list.addEventListener('click', function(ev) {
	  if (ev.target.tagName === 'LI') {
	    ev.target.classList.toggle('checked');
	    updateDataCode();
	  }
	}, false);


	// Create a new list item when clicking on the "Add" button
	function newElement(inputValue = "") {
	  if(inputValue == "") {
	    var inputValue = document.getElementById("myInput").value;
	  }

	  var checked = false;
	  if(inputValue[inputValue.length-1] == "."){
	  	checked = true;
	  	inputValue = inputValue.substr(0, inputValue.length-1); //remove 1
	  }

	  var t = document.createTextNode(inputValue);
	  var li = document.createElement("li");
	  if(checked){
	  	li.setAttribute("class",'checked');
	  }

	  li.appendChild(t);
	  if (inputValue === '') {
	    alert("You must write something!");
	  } else {
	    document.getElementById("myUL").appendChild(li);
	  }
	  document.getElementById("myInput").value = "";

	  var span = document.createElement("SPAN");
	  var txt = document.createTextNode("\u00D7");
	  span.className = "close";
	  span.appendChild(txt);
	  li.appendChild(span);


	  for (i = 0; i < close.length; i++) {
	    close[i].onclick = function() {
	      var div = this.parentElement;
	      div.remove();
	      updateDataCode();
	    }
	  }

	  updateDataCode();

	}		

	function getDataString(){

		var data = document.getElementsByTagName('li');

		var test = []
		for(var i = 0; i < data.length; i++){
			item = data[i].innerHTML;
			item = item.replace(/<\/?span[^>]*>/g,"");
			item = item.substr(0, item.length-1); // remove "x"
			item = item.split(' ').join('-'); // change spaces with "-"
			
			if (data[i].className == "checked"){
				item = item + "$";
			} else {
				item = item + "+";
			}
			//var keyStrUriSafe = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$";
			//Convert to URI " " -> "-", "new line" -> +, "checked" -> $

			test.push(item); //removes "x" and adds "zz" for return
		}
		
		for(var i = 0; i< test.length; i++){
			test[i] = reverseFirstLeter(test[i]);
		}

		var words = "" 
		for(var i = 0; i < data.length; i++){
			words = words + test[i]
		}
		
		return words;

	}

	function reverseFirstLeter(str){
		if(str == ""){ return ""; }
		if(str.charAt(0) == str.charAt(0).toUpperCase()){
			return str.charAt(0).toLowerCase() + str.slice(1);
		}else{
			return str.charAt(0).toUpperCase() + str.slice(1);
		}
	}

	function updateDataCode(){

		dataCode = getDataString();

		var post = document.getElementById("code");
		post.value = "pucula.com/list/?" + encodeShortLetters(dataCode);


	}

	function encodeShortLetters(dataString){
		var commonLetters =   "-+$etaoinshrdlcumwfgypbvkjxqz1234567809TAOISWCBPHFMDRELNGUVYJKQXZ"
		var shortestLetters = "ijltfrI-sJzacebdghnopq1uvxky023456789$FPS+LZTERBCDGHwKNOQAUVXYmMW"

		var newWord = [];
		var letterIndex = 0;
		for(var i = 0; i < dataString.length;i++){
			letterIndex = commonLetters.indexOf(dataString[i]);
			newWord = newWord + shortestLetters[letterIndex];
		}

		return newWord
	}

	function decodeShortLetters(dataString){
		var commonLetters =   "-+$etaoinshrdlcumwfgypbvkjxqz1234567809TAOISWCBPHFMDRELNGUVYJKQXZ"
		var shortestLetters = "ijltfrI-sJzacebdghnopq1uvxky023456789$FPS+LZTERBCDGHwKNOQAUVXYmMW"

		var newWord = [];
		var letterIndex = 0;
		for(var i = 0; i < dataString.length;i++){
			letterIndex = shortestLetters.indexOf(dataString[i]);
			newWord = newWord + commonLetters[letterIndex];
		}

		return newWord


	}


	function writeCode(code){

		code = decodeShortLetters(code);

		code = code.split('-').join(' ');
		console.log(code);
		var listMaybe = code.replace(/\$/g,".$").split(/\+|\$/);
		console.log(listMaybe);
		listMaybe.splice(-1,1); //Remove blank element
		
		for(var i = 0; i< listMaybe.length; i++){
			listMaybe[i] = reverseFirstLeter(listMaybe[i]);
		}


		for(var i = 0; i < listMaybe.length; i++){
			newElement(listMaybe[i]);
		}

	}

	function initCode(code){
		
		if (code == '' || code == null){
			newElement("Hit the gym");
			newElement("Pay bills.");
			newElement("Meet George");
			newElement("Buy eggs");
			newElement("Read a book");
			newElement("Organize Office.");
		} else {
			writeCode(code);
		}

	}


	//copy to clipboard function
	(function() {
	  'use strict';
	  // click events
	  document.body.addEventListener('click', copy, true);
	  // event handler
	  function copy(e) {
	    // find target element
	    var
	      t = e.target,
	      c = t.dataset.copytarget,
	      inp = (c ? document.querySelector(c) : null);
	    // is element selectable?
	    if (inp && inp.select) {
	      // select text
	      inp.select();
	      try {
	        // copy text
	        document.execCommand('copy');
	        inp.blur();
	      }
	      catch (err) {
	        alert('please press Ctrl/Cmd+C to copy');
	      }
	    }
	  }

	})();

	var url = window.location.href;
	var array = url.split("?");
	var code = array[1];
	window.onload = initCode(code);

	</script>


	
</article>


<!--
No Change: 744
Reduction to most common characters: 632
Changing the first case on the to-do list items: 536 
Changed the checked to also include a newline: 525
