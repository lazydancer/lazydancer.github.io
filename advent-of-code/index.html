<html>
<head>
    <title>Advent of Code - James Pucula</title>
    <meta charset='UTF-8'>
    <meta content='width=device-width, initial-scale=1' name='viewport'/>

    <meta name='description' content='James Pucula'>
    <meta name='keywords' content='static, writing'>
    <meta name='author' content='James Pucula'>

    <link href='/css/blog.css' rel='stylesheet'/>
    <link href='/css/trac.css' rel='stylesheet'/>
    <link href='/css/markdown.css' rel='stylesheet'/>

    <script type='text/x-mathjax-config'>
MathJax.Hub.Config({
  jax: ['input/TeX', 'output/HTML-CSS'],
  tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
    extensions: ['color.js']
  },
  messageStyle: 'none',
  'HTML-CSS': { preferredFont: 'TeX', availableFonts: ['STIX','TeX'] }
});
</script>

<script src='//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML' type='text/javascript'></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
</head>
<body>
<div class='content'>
    <div class='nav'>
    <ul class='wrap'>
        <li><a href='/'><img src='/assets/logo.png'></img></a></a></li>
    </ul>
</div>
    <div class='front-matter'>
        <div class='wrap'>
            <h1>Advent of Code</h1>
            <h4>I take part in a yearly coding challenge in december, posting my solutions</h4>
            <div class='bylines'>
                <div class='byline'>
                    <h3>Published</h3>
                    <p>01 December 2019</p>
                </div>
                <div class='byline'>
                    <h3>Updated</h3>
                    <p>01 January 2020</p>
                </div>
            </div>
            <div class='clear'></div>
        </div>
    </div>
    <div class='wrap article'>
        <p>I first participated in Advent of Code in 2018. I enjoyed working through the challenges and I learned a lot</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    !
  -~*~-
   /!\
  /%;@\
 o/@,%\o
 /%;`@,\
o/@'%',\o
'^^^N^^^`
</code></pre></div></div>

<p>I continue to update this post for each year</p>

<ul>
  <li><a href="#2019">2019</a></li>
  <li><a href="#2018">2018</a></li>
</ul>

<h2 id="2019">2019</h2>

<p>I posted my solutions to GitHub: <a href="https://github.com/lazydancer/Advent-of-Code-2019">lazydancer/Advent-of-Code-2019</a></p>

<h2 id="2018">2018</h2>

<p>I enjoy the challenges, as I can learn new how people solve the same question. It’s not common for many people to be solving the same probelm and it can offer a unique opportunity to learn. This year I learned about assembly language and python imports</p>

<h3 id="assembly">Assembly</h3>

<p>I have always be interested in how computers work, <em>see</em> <a href="https://pucula.com/notes/making-a-transistor-from-scratch-part-1.html">building a transistor from scratch</a>. I have never had the chance to program in assembly. That changed on <a href="https://adventofcode.com/2018/day/16">Day 16</a>, the challenge was to run a new programming language called elf code. Elf code looks similar to machine code, and example is seen below</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4 0 2 0
13 2 0 2
2 2 3 2
4 3 2 3
3 3 2 2
13 2 1 2
6 2 1 1
10 1 2 3
4 2 3 0
13 1 0 1
2 1 1 1
</code></pre></div></div>

<p>The first number is the opcode, which could represent 1 of 16 operations, ‘add’, ‘mul’, ‘mov’. The second and third were inputs and the forth was what register to use for the output</p>

<p>First, I wrote the code in python. It turned out way too slow, even with pypy and a better data structure. I got it down to 1/10th of the original but after 3 hours, I stopped it</p>

<p>To solve it, you need to watch how the elf code is being executed, find the pattern and simplify the logic. I was curious if this could be completed by running right on the hardware</p>

<p>Using an intermeddiate step to C, Below is a snippet of the assembly. ‘;’ is a comment. The ‘l01’, ‘l02’, ‘l03’ and ‘l07’ are labels. For example the first command is jmp l17, which is jump to label l17</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="nf">jmp</span>       <span class="nv">l17</span>           <span class="c1">;  L00: goto *jump_table[0+16+1]; //addi 3 16 3</span>
<span class="nl">l01:</span>  <span class="nf">mov</span>       <span class="nv">r11</span><span class="p">,</span> <span class="mi">1</span>        <span class="c1">;  L01: reg[1] = 1; //seti 1 2 1</span>
<span class="nl">l02:</span>  <span class="nf">mov</span>       <span class="nv">r12</span><span class="p">,</span> <span class="mi">1</span>        <span class="c1">;  L02: reg[2] = 1; //seti 1 1 2</span>
<span class="nl">l03:</span>  <span class="nf">mov</span>       <span class="nb">rax</span><span class="p">,</span> <span class="nv">r11</span>      <span class="c1">;  L03: reg[5] = reg[1] * reg[2]; //mulr 1 2 5</span>
      <span class="nf">mov</span>       <span class="nb">rbx</span><span class="p">,</span> <span class="nv">r12</span>      <span class="c1">;</span>
      <span class="nf">imul</span>      <span class="nb">rax</span><span class="p">,</span> <span class="nb">rbx</span>      <span class="c1">;</span>
      <span class="nf">mov</span>       <span class="nv">r15</span><span class="p">,</span> <span class="nb">rax</span>      <span class="c1">;</span>
      <span class="nf">cmp</span>       <span class="nv">r15</span><span class="p">,</span> <span class="nv">r14</span>      <span class="c1">;  L04: reg[5] = reg[5] == reg[4]; //eqrr 5 4 5</span>
      <span class="nf">sete</span>      <span class="nb">al</span>            <span class="c1">;  Grab the flag</span>
      <span class="nf">movzx</span>     <span class="nv">r15</span><span class="p">,</span> <span class="nb">al</span>       <span class="c1">;  Move the flag to r15 extends with zeros</span>
      <span class="nf">je</span>        <span class="nv">l07</span>           <span class="c1">;  L05: goto *jump_table[reg[5] + 5 + 1]; //addr 5 3 3</span>
      <span class="nf">jmp</span>       <span class="nv">l08</span>           <span class="c1">;  L06: goto *jump_table[6 + 1 + 1]; //addi 3 1 3</span>
<span class="nl">l07:</span>  <span class="nf">add</span>       <span class="nv">r10</span><span class="p">,</span> <span class="nv">r11</span>      <span class="c1">;  L07: reg[0] = reg[1] + reg[0]; //addr 1 0 0</span>
</code></pre></div></div>

<p>In the end the assembly was not fast enough, even being roughly 20x faster than my original python implementation</p>

<p>Along the way I learned x86-64 commands, registers, flags and jump commands. I also learned why assembly is not written. This code ran about as fast as the C code that I made but not being portable between different computers and being somewhat hard to follow. Below is the code to write a single character to the screen</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">print:</span>
      <span class="nf">mov</span>       <span class="p">[</span><span class="nv">value</span><span class="p">],</span> <span class="nv">r10</span>     
      <span class="nf">mov</span>       <span class="nb">rax</span><span class="p">,</span> <span class="mi">1</span>           <span class="c1">; system call for write</span>
      <span class="nf">mov</span>       <span class="nb">rdi</span><span class="p">,</span> <span class="mi">1</span>           <span class="c1">; file handle 1 is stdout</span>
      <span class="nf">mov</span>       <span class="nb">rsi</span><span class="p">,</span> <span class="nv">value</span>       <span class="c1">; address of string to output</span>
      <span class="nf">mov</span>       <span class="nb">rdx</span><span class="p">,</span> <span class="mi">8</span>           <span class="c1">; number of bytes</span>
      <span class="nf">syscall</span>                    <span class="c1">; invoke operating system to do the write</span>
      <span class="nf">mov</span>       <span class="nb">rax</span><span class="p">,</span> <span class="mi">60</span>          <span class="c1">; system call for exit</span>
      <span class="nf">xor</span>       <span class="nb">rdi</span><span class="p">,</span> <span class="nb">rdi</span>         <span class="c1">; exit code 0</span>
      <span class="nf">syscall</span>                    <span class="c1">; invoke operating system to exit </span>
</code></pre></div></div>

<h3 id="python-imports">Python Imports</h3>

<p>Most of the time I avoid python imports, I found the default data types do the job. During these challenges, I have come to love defaultdict, copy, dequeue. Also networkx for building networks and re for regular expression</p>

<p><strong>defaultdict</strong> - Having a set value for when nothing exist is a very useful feature</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">somedict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">print</span><span class="p">(</span><span class="n">somedict</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="c1"># KeyError
</span>
<span class="n">someddict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">someddict</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="c1"># print int(), thus 0
</span></code></pre></div></div>

<p><strong>copy</strong> - Because python calls list by reference this is useful to keep things functional</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">copy</span>
<span class="n">copy</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">copy</span><span class="p">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>dequeue</strong> - A double-ended queue, this is useful for when rotation is needed with a rotate function</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">d</span><span class="p">.</span><span class="n">rotate</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>networkx</strong> - This was useful for all types of graph equations. Shortest path was used many times</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">graph</span> <span class="o">=</span> <span class="n">networkx</span><span class="p">.</span><span class="n">Graph</span><span class="p">()</span>
<span class="c1"># ...adding nodes...
</span><span class="n">result</span> <span class="o">=</span> <span class="n">networkx</span><span class="p">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</code></pre></div></div>
<p><strong>re</strong> - This is a very popular library I have tried to avoid it</p>

<p><em>Some people, when confronted with a problem, think “I know, I’ll use regular expressions.” Now they have two problems</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r'-?\d+'</span><span class="p">,</span> <span class="n">line</span><span class="p">)))</span>
</code></pre></div></div>

    </div>
    <div id='bibliography'>
        <div class='wrap'>
            <ol class="bibliography"></ol>
        </div>
    </div>
</div>
</body>
</html>