---
title: Pictures to Text
date: 2021-11-01
description: Convert any image into text art
---

<h1>Pictures to Text</h1>
<div class="project-links">
    <a class="github-icon" href="https://github.com/lazydancer/pictotxt" aria-label="View Pictures to Text on GitHub">
        <svg aria-hidden="true" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38C13.71 14.53 16 11.54 16 8c0-4.42-3.58-8-8-8z"></path>
        </svg>
        <span>GitHub</span>
    </a>
</div>

<img src="cat_example.gif" />

<p>A fun little weekend project, I created a program which converted a picture into text. To complete this I used jupyter notebook, found below. The code is available on <a href="https://github.com/lazydancer/pictotxt">github</a>.</p>



<p>The notebook contains 3 parts:</p>
<ol>
  <li><strong>Image</strong> - Input image to be converted. It's chopped up into little bits.</li>
  <li><strong>Font</strong> - Input font. The characters are extracted as images.</li>
  <li><strong>Calc</strong> - the images and font characters are compared to find the best match</li>
</ol>

<p>First thing is import the image. As an example I use the finch. Most of the following code is to convert the image from a PIL array to numpy's 2D narray and use matplotlib plot function.</p>

<pre><code>def show_image(path):
    image = Image.open(path)
    image = image.convert('L')
    d = list(image.getdata())
    image_2D = np.reshape(d, (image.height, image.width))
    plt.imshow(image_2D, cmap='gray')

show_image('download.png')
</code></pre>
<p>Output:</p>
<div class="centerImage">
<img src="download (1).png" style="max-width: 500px;" /> 
</div>

<p>The next step is taking the imported image and converting it into character sized images. The heart of the following methods are the <strong>view_as_blocks</strong>. The function fails if there is an overlap with the  edge of the imported image. The function <strong>trim_image</strong> is there to remove the excess before it sent in to <strong>view_as_blocks</strong>. The result can be seen below.</p>

<code>def trim_image(matrix, size_x, size_y):
    height, width = matrix.shape
    trim_height = height % size_y
    trim_width = width % size_x
    
    if trim_height > 0:
        matrix = matrix[:-trim_height,...]
    
    if trim_width > 0:
        matrix = matrix[...,:-trim_width]
    
    return matrix
    
def get_image_slices(image_path, char_width, char_height):
    image = Image.open(image_path)
    image = image.convert('L') #greyscale
    
    data = list(image.getdata())
    image_2D = np.reshape(data, (image.height, image.width))
    
    image_2D = trim_image(image_2D, char_width, char_height)
    image_slices = view_as_blocks(image_2D, block_shape=(char_height,char_width))
    
    return image_slices

char_width = 10
char_height = 18
image_slices = get_image_slices('download.png', char_width, char_height)


images = image_slices.reshape(image_slices.shape[0]*image_slices.shape[1],
            image_slices.shape[2], image_slices.shape[3])
nb_across = image_slices.shape[0]
nb_down = image_slices.shape[1]
plt.figure()
for i, img in enumerate(images):
    plt.subplot(nb_across, nb_down, i+1)
    plt.imshow(img, cmap='gray', vmin=0, vmax=255)
</code>

<p>Output:</p>
<div class="centerImage">
<img src="download2.png" style="max-width: 500px;" /> 
</div>

<h2 id="fonts">Fonts</h2>

<p>Now we have the images, we can match characters to them. First we need to get images of the font to compare. We will be using the ascii character set, this is found in the <strong>string.printable</strong> function.</p>

<code>def font_images():
    fnt = ImageFont.truetype('fonts/SFMono-Regular.otf', 15)
    import string
    letters = string.printable
    results = []

    for letter in letters:
        img = Image.new('RGB', (10, 18), color=(255,255,255))
        d = ImageDraw.Draw(img)
        d.text((0,0),letter, font=fnt, fill=(0,0,0))
        img = img.convert('L') #greyscale
        
        d = list(img.getdata())
        image_2D = np.reshape(d, (img.height, img.width))
        
        results.append(image_2D)
        
    return (letters, np.stack(results, axis=0))

letters_idx, letters = font_images()

plt.figure(figsize=(60,60))
for i, img in enumerate(letters):
    plt.subplot(20, 20, i+1)
    plt.imshow(img, cmap='gray', vmin=0, vmax=255)
</code>

<p>Output:</p>
<div class="centerImage">
<img src="download3.png" style="max-width: 500px;" /> 
</div>

<h2 id="calc">Calc</h2>

<p>Now we have sections of the input image and character images, we just need to pick the best match. In this case I used:</p>

<div class="centerImage">
<img src="download4.png" style="max-width: 500px;" /> 
</div>

<p>where A and B are matrices of the same size. We want the lowest score as that will be the smallest difference. I guess I could have inverted it so we were looking for the max or I could have called it the loss function.</p>

<code>def solve_section(section, letters):
    min_score = 1000000
    min_letter = None
    id = 0
    
    for letter in letters:
        score = np.sum(np.absolute(letter - section))
        if score < min_score:
            min_score = score
            min_letter = letter
            min_id = id
        id += 1
            
    return (min_id, min_letter)

def solve(sections, letters):
    results = []
    ids = []
    for s in sections:
        id, min_letter = solve_section(s, letters)
        results.append(min_letter)
        ids.append(id)

    return (ids, np.stack(results, axis=0))

ids, result = solve(f, letters)

fig = plt.figure(figsize=(20, 20))

for i in range(len(result)):
    sub = fig.add_subplot(image_slices.shape[0], image_slices.shape[1], i+1)
    sub.imshow(result[i], cmap='gray', vmin=0, vmax=255)
</code>

<p>Output:</p>
<div class="centerImage">
<img src="download5.png" style="max-width: 500px;" /> 
</div>

<p>Now we can finish it by collecting the characters and printing</p>

<code>result_string = ""
i = 1
for id in ids:
    result_string += letters_idx[id]
    if i % image_slices.shape[1] == 0:
        result_string += '\n'
    i += 1

print(result_string)
</code>

<p>Output:</p>

<code>.gMBy         
  WgM_        
  M@DMg_      
  $BMGDMg     
   `MgZMMg_   
    _&lt;V _MMK_ 
  _1P"`    "gg
</code>
